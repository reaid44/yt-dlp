<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>REAID SARDAR тАФ Downloader v2.3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fonts: Segoe UI fallback + Noto Sans Bengali -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- External CSS -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="topbar">
            <h1>ЁЯУе DOWNLOAD</h1>
            <button class="theme-toggle" id="themeToggle" aria-label="ржерж┐ржо ржкрж░рж┐ржмрж░рзНрждржи">ЁЯМЧ</button>
        </header>

        <p class="subtitle">ржЗржЙржЯрж┐ржЙржм рж▓рж┐ржВржХ ржжрж┐ржи, ржЖржорж░рж╛ ржкрзНрж░рж╕рзЗрж╕ ржХрж░ржмред</p>

        <!-- Input -->
        <div class="input-group">
            <input type="text" id="urlInput" placeholder="ржЗржЙржЯрж┐ржЙржм рж▓рж┐ржВржХ ржжрж┐ржи..." required aria-label="ржЗржЙржЯрж┐ржЙржм рж▓рж┐ржВржХ">
            <button type="button" class="arrow" onclick="startProcessing()" aria-label="ржкрзНрж░рж╕рзЗрж╕ рж╢рзБрж░рзБ">
                <img src="/static/icons/red-arrow.png" alt="Arrow" class="arrow-icon">
            </button>
        </div>

        <!-- Status -->
        <div id="status" class="status-text" role="status" aria-live="polite">
            тП│ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж╣ржЪрзНржЫрзЗ<span id="dots"></span>
        </div>

        <!-- Format Options -->
        <div id="format-options" class="dropdown hidden" aria-hidden="true">
            <button onclick="download('mp4')" class="btn-primary">ЁЯОе MP4</button>
            <button onclick="download('mp3')" class="btn-primary">ЁЯФК MP3</button>
            <button onclick="download('both')" class="btn-primary">ЁЯОм MP4-MP3</button>
        </div>

        <!-- Preview -->
        <div class="preview">
            <img src="/static/thumbnail.jpg" alt="ржнрж┐ржбрж┐ржУ ржерж╛ржорзНржмржирзЗржЗрж▓" id="thumb">
            <p class="video-title" id="videoTitle">ЁЯОм Big Buck Bunny UHD</p>
        </div>

        <!-- Popup Modal -->
        <div id="popup" class="popup hidden" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
          <div class="popup-content">
            <button class="close-btn" onclick="closePopup()" aria-label="ржмржирзНржз ржХрж░рзБржи">├Ч</button>
            <h2 id="popupTitle">тД╣я╕П ржирзЛржЯрж┐рж╢</h2>
            <p id="popupMessage">ржЖржкржирж╛рж░ ржлрж╛ржЗрж▓ ржкрзНрж░рж╕рзНрждрзБржд рж╣рзЯрзЗржЫрзЗ! ржПржЦржи ржбрж╛ржЙржирж▓рзЛржб ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред</p>
            <div class="popup-actions">
              <button class="btn-primary" onclick="closePopup()">ржарж┐ржХ ржЖржЫрзЗ</button>
            </div>
          </div>
        </div>
    </div>

    <!-- Footer Version -->
    <footer class="footer">
        <p>ЁЯФЦ Version v2.3</p>
    </footer>

    <!-- JavaScript -->
    <script>
    // Animated dots
    let dotCount = 0;
    setInterval(() => {
        dotCount = (dotCount + 1) % 4;
        document.getElementById("dots").innerText = ".".repeat(dotCount);
    }, 500);

    // Theme: auto-detect + toggle + persist
    const prefersLight = window.matchMedia("(prefers-color-scheme: light)");
    const themeToggle = document.getElementById("themeToggle");

    function applyTheme(theme) {
        const body = document.body;
        if (theme === "light") body.classList.add("light");
        else body.classList.remove("light");
        localStorage.setItem("theme", theme);
        themeToggle.textContent = body.classList.contains("light") ? "ЁЯМЮ" : "ЁЯМЧ";
    }

    function initTheme() {
        const saved = localStorage.getItem("theme");
        if (saved) {
            applyTheme(saved);
        } else {
            applyTheme(prefersLight.matches ? "light" : "dark");
        }
    }

    themeToggle.addEventListener("click", () => {
        const current = document.body.classList.contains("light") ? "light" : "dark";
        applyTheme(current === "light" ? "dark" : "light");
    });

    prefersLight.addEventListener("change", (e) => {
        const saved = localStorage.getItem("theme");
        if (!saved) applyTheme(e.matches ? "light" : "dark");
    });

    // Popup helpers
    function showPopup(message) {
        document.getElementById("popupMessage").innerText = message;
        document.getElementById("popup").classList.remove("hidden");
    }
    function closePopup() {
        document.getElementById("popup").classList.add("hidden");
    }

    // Prepare + update UI
    async function startProcessing() {
        const url = document.getElementById("urlInput").value.trim();
        if (!url) {
            showPopup("тЪая╕П ржЗржЙржЯрж┐ржЙржм рж▓рж┐ржВржХ ржжрж┐ржи");
            return;
        }

        const status = document.getElementById("status");
        const dropdown = document.getElementById("format-options");
        status.textContent = "тП│ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж╣ржЪрзНржЫрзЗ...";
        dropdown.classList.add("hidden");
        dropdown.setAttribute("aria-hidden", "true");

        try {
            const res = await fetch("/prepare", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url })
            });
            const data = await res.json();

            if (data.title) document.getElementById("videoTitle").textContent = `ЁЯОм ${data.title}`;
            if (data.thumbnail) document.getElementById("thumb").src = data.thumbnail;

            if (data.ready) {
                status.textContent = "тЬЕ ржлрж╛ржЗрж▓ ржкрзНрж░рж╕рзНрждрзБржд!";
                dropdown.classList.remove("hidden");
                dropdown.setAttribute("aria-hidden", "false");
                showPopup("ржЖржкржирж╛рж░ ржлрж╛ржЗрж▓ ржкрзНрж░рж╕рзНрждрзБржд рж╣рзЯрзЗржЫрзЗ! ржПржЦржи ржлрж░ржорзНржпрж╛ржЯ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЗ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржиред");
            } else {
                status.textContent = "тЭМ ржбрж╛ржЙржирж▓рзЛржб ржмрзНржпрж░рзНрже рж╣рзЯрзЗржЫрзЗ";
                showPopup("ржбрж╛ржЙржирж▓рзЛржб ржмрзНржпрж░рзНрже рж╣рзЯрзЗржЫрзЗред рж▓рж┐ржВржХржЯрж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");
            }
        } catch (e) {
            status.textContent = "тЭМ рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐";
            showPopup("рж╕рж╛рж░рзНржнрж╛рж░ ржмрж╛ ржирзЗржЯржУрзЯрж╛рж░рзНржХ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗред ржХрж┐ржЫрзБржХрзНрж╖ржг ржкрж░рзЗ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");
        }
    }

    function download(type) {
        window.location.href = `/download?type=${encodeURIComponent(type)}`;
    }

    // Init
    window.addEventListener("DOMContentLoaded", initTheme);
    </script>
</body>
</html>
